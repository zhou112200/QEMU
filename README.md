QEMU虚拟机安装脚本使用说明
一、脚本概述

本脚本旨在为用户提供一种在Windows环境下方便快捷地创建和启动QEMU虚拟机的方式，通过简单的交互操作，获取必要的参数，自动化完成一系列复杂的配置过程，降低了使用QEMU的技术门槛，特别适合初学者或希望快速搭建虚拟机环境的用户。

二、脚本功能

1. 路径检查：严格检查当前工作目录路径是否包含中文字符，确保后续操作的兼容性，若路径包含中文则提示用户修正。

2. 文件检索：在当前目录下查找特定格式（.fd为配置文件，.qcow2为镜像文件）的文件，若未找到配置文件则给出提示。

3. 用户输入获取与校验：引导用户输入镜像名称（仅限英文或数字）、镜像大小（单位GB，必须为数字且大于0）、CPU核心数（必须为数字且大于0）和内存大小（单位GB，必须为数字且大于0），对输入进行实时校验，不符合要求则提示重新输入。

4. 镜像创建：根据用户输入的参数，使用qemu-img create命令创建qcow2格式的虚拟机镜像文件，创建过程中检查错误并给出详细反馈。

5. 安装启动选择与ISO文件选择：提供用户选择是否启动虚拟机安装，若选择启动，则遍历当前目录下的ISO文件，让用户选择用于安装的ISO镜像，最后使用qemu-system-x86_64.exe命令启动虚拟机安装过程，传递用户指定的参数，并在启动过程中检查错误。

三、使用步骤

1. 准备工作
确保系统中已安装QEMU，并且qemu-img和qemu-system-x86_64.exe命令在系统环境变量的可执行路径中，否则脚本将无法正常运行。
准备好用于虚拟机安装的ISO镜像文件，并将其放置在与脚本相同的目录下。

2. 运行“说明.bat”
双击“说明.bat”文件，脚本将输出关于整个操作流程的详细提示信息，包括脚本的功能、注意事项等，让用户在运行前充分了解脚本的作用和限制。
阅读提示信息后，按任意键继续，此时将自动调用“QEMU.bat”脚本开始执行核心操作。

3. 运行“QEMU.bat”（由“说明.bat”自动调用）
路径检查：脚本首先检查当前路径是否包含中文，若包含则提示“当前路径包含中文，请修正后重试。”并暂停等待用户操作，用户需修正路径后重新运行脚本；若路径检查通过，则继续下一步文件检索：在当前目录下查找配置文件（.fd）和镜像文件（.qcow2），若未找到配置文件，提示“未检索到配置文件，请检查后再试！”并暂停等待用户检查，找到配置文件后继续。
获取用户输入
镜像名称：提示“请输入镜像名称(请输入英文或数字)”，用户输入后，脚本校验是否为英文或数字，若不符合要求则提示重新输入，直到输入正确为止。
镜像大小：提示“请输入镜像大小/gb”，用户输入后，校验是否为数字且大于0，不符合则提示重新输入，正确后显示“镜像大小[输入大小]/gb.”。
CPU核心数：提示“请输入CPU核心数”，输入后校验是否为数字且大于0，错误则重新输入，正确后显示“选择的CPU核心数: [输入核心数]”。
内存大小：提示“请输入内存大小/GB”，校验输入是否为数字且大于0，不合法则重新输入，合法后显示“选择的内存大小: [输入内存大小] GB”。
创建镜像：根据用户输入的参数创建镜像文件，若创建成功，提示“生成文件成功：[当前路径][镜像名称].qcow2”；若失败，显示详细错误信息“生成镜像文件失败，详细错误: [错误内容]”并暂停等待用户操作。
安装启动选择：提示用户选择“1.启动安装”或“2.结束脚本”，若选择“1”，则继续下一步；若选择“2”，则结束脚本。
选择ISO文件（若启动安装）：遍历当前目录下的ISO文件，逐个显示文件名并询问用户是否选择（Y/N），用户选择“Y”则确定使用该ISO文件，选择“N”则继续询问下一个文件，若未选择任何文件则提示“选择文件错误，请重新选择！”并重新开始选择过程。确定ISO文件后，脚本将启动虚拟机安装过程，显示“执行安装程序中，请勿关闭”，并在安装完成后提示“结束安装，下一次启动请执行start.bat”。

四、注意事项

1. 路径要求：整个操作过程中，脚本所在路径以及涉及的文件名称均不能包含中文字符，否则可能导致脚本执行失败或出现不可预期的错误。

2. 输入规范：严格按照脚本提示输入相应内容，特别是镜像名称必须为英文或数字，镜像大小、CPU核心数和内存大小必须为符合要求的数字。

3. 环境依赖：确保系统已正确安装QEMU且相关命令可执行，同时准备好合适的ISO镜像文件，否则将无法完成虚拟机的创建和安装。

五、常见问题及解决方法

1. 路径包含中文错误
问题描述：运行脚本时提示“当前路径包含中文，请修正后重试。”
解决方法：将脚本移动到不包含中文的路径下，或者修改当前路径的名称，使其不包含任何中文字符，然后重新运行脚本。

2. 未检索到配置文件错误
问题描述：提示“未检索到配置文件，请检查后再试！”
解决方法：检查当前目录下是否存在以.fd为扩展名的配置文件，若不存在，确保将正确的配置文件放置在脚本所在目录，然后再次运行脚本。

3. 输入错误（如镜像名称非英文数字、大小或核心数内存数不合法等）
问题描述：根据不同输入项，提示相应的错误信息，如“您输入的不是英文或数字，请重新输入！”“输入的文件大小错误，请重新输入！”等。
解决方法：按照提示要求重新输入正确的内容，确保镜像名称为英文或数字，大小和核心数、内存数为合法的数字且符合要求。

4. 镜像创建失败错误
问题描述：提示“生成镜像文件失败，详细错误: [错误内容]”
解决方法：根据详细错误信息排查问题，可能原因包括磁盘空间不足、输入的镜像大小超出系统支持范围等。确保有足够的磁盘空间，并且输入的镜像大小合理，然后再次尝试创建镜像。

5. QEMU启动失败错误
问题描述：提示“Qemu启动失败，详细错误: [错误内容]”
解决方法：仔细阅读错误信息，常见原因可能是ISO文件选择错误、系统资源不足、QEMU配置问题等。检查ISO文件是否正确选择且可正常使用，确保系统有足够的CPU、内存和磁盘资源来运行虚拟机，若问题仍然存在，检查QEMU的安装和配置是否正确，必要时参考QEMU官方文档进行排查。
